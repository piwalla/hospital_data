# 다음 작업 우선순위 가이드

**작성일**: 2025-01-14  
**기준**: PRD.md 디자인 시스템 + TODO.md 진행 상황

---

## 🎯 우선순위별 작업 목록

### 🔴 Priority 1: 데이터 완성도 (즉시 필요)

#### 1-1. 재활기관 Geocoding 처리
**왜 필요한가?**
- 재활기관 2,368개가 Import되었지만 좌표가 모두 0으로 설정되어 있음
- 지도에 표시하려면 주소를 위도/경도로 변환해야 함
- 이미 Geocoding API가 구현되어 있음 (`app/api/rehabilitation-centers/geocode/route.ts`)

**작업 내용:**
- [ ] Geocoding API 실행 스크립트 생성 또는 수동 실행
- [ ] Geocoding 결과 검증 (성공률 확인)
- [ ] 실패한 주소 재시도 (VWorld API 활용)

**예상 소요 시간**: 1-2시간 (2,368개 처리, API 호출 제한 고려)

**참고 파일:**
- `app/api/rehabilitation-centers/geocode/route.ts`
- `app/api/hospitals/geocode-vworld/route.ts` (VWorld 재시도 로직 참고)

---

#### 1-2. 재활기관 지도 연동
**왜 필요한가?**
- PRD에 "병원, 약국, 재활기관" 통합 표시가 명시되어 있음
- 현재는 병원/약국만 지도에 표시됨
- 재활기관도 사용자가 찾을 수 있어야 함

**작업 내용:**
- [ ] `HospitalMap` 컴포넌트에 재활기관 데이터 prop 추가
- [ ] 재활기관 마커 표시 (병원/약국과 다른 색상 또는 아이콘)
- [ ] 재활기관 InfoWindow 구현 (기관구분 표시)
- [ ] 재활기관 상세 정보 Bottom Sheet 연동
- [ ] `app/hospitals/page-client.tsx`에서 재활기관 데이터 fetch 및 통합
- [ ] 기관 유형별 필터링 UI 추가 (병원/약국/재활기관)

**예상 소요 시간**: 3-4시간

**참고 파일:**
- `components/HospitalMap.tsx`
- `app/hospitals/page-client.tsx`
- `components/HospitalDetailSheet.tsx` (재활기관용으로 확장 또는 별도 컴포넌트)

---

### 🟡 Priority 2: 사용자 경험 개선 (중요)

#### 2-1. 진료과목별 필터링 기능
**왜 필요한가?**
- PRD에 "정형외과, 내과 등 진료과목별 필터링" 요구사항 명시
- 사용자가 필요한 진료과목만 빠르게 찾을 수 있어야 함
- TODO.md에서 다음 우선순위로 표시됨

**작업 내용:**
- [ ] 진료과목 데이터 분석 (현재 데이터에 어떤 진료과목이 있는지 확인)
- [ ] 필터 UI 컴포넌트 생성 (체크박스 또는 드롭다운)
- [ ] 필터링 로직 구현 (`lib/api/hospitals.ts`에 `getHospitalsByDepartment` 함수)
- [ ] 지도 및 목록에 필터 적용
- [ ] 필터 상태 관리 (URL 쿼리 파라미터 또는 상태 관리)

**예상 소요 시간**: 2-3시간

**참고 파일:**
- `lib/api/hospitals.ts`
- `app/hospitals/page-client.tsx`
- `components/HospitalMap.tsx`

---

#### 2-2. 기관 유형별 필터링 (병원/약국/재활기관)
**왜 필요한가?**
- 재활기관 지도 연동 후 3가지 기관 유형이 모두 표시됨
- 사용자가 원하는 기관 유형만 선택해서 볼 수 있어야 함
- PRD에 "기관 유형별 필터링" 명시

**작업 내용:**
- [ ] 필터 UI 추가 (병원/약국/재활기관 토글 또는 체크박스)
- [ ] 필터링 로직 구현 (지도 마커, 목록 모두 필터링)
- [ ] 필터 상태에 따른 마커 색상/아이콘 변경

**예상 소요 시간**: 1-2시간

**참고 파일:**
- `components/HospitalMap.tsx`
- `app/hospitals/page-client.tsx`

---

### 🟢 Priority 3: 디자인 시스템 일관성 (개선)

#### 3-1. PRD 타이포그래피 시스템 검증 및 적용
**왜 필요한가?**
- PRD에 명시된 타이포그래피가 이미 `globals.css`에 정의되어 있음
- 하지만 실제 컴포넌트에서 일관되게 사용되고 있는지 확인 필요
- 특히 `.caption` 클래스가 실제로 사용되고 있는지 확인

**작업 내용:**
- [ ] 현재 컴포넌트에서 타이포그래피 사용 현황 확인
- [ ] PRD 규격과 다른 부분 수정 (h1, h2, body, caption)
- [ ] 컴포넌트별 타이포그래피 일관성 검증
- [ ] 필요시 Tailwind CSS 유틸리티 클래스로 표준화

**예상 소요 시간**: 1-2시간

**참고 파일:**
- `app/globals.css` (129-141줄: 타이포그래피 스케일 정의)
- `components/HospitalDetailSheet.tsx`
- `app/hospitals/page-client.tsx`
- `components/HospitalMap.tsx`

---

#### 3-2. 색상 팔레트 일관성 검증
**왜 필요한가?**
- PRD에 명시된 색상이 `globals.css`에 정의되어 있음
- 하지만 실제 컴포넌트에서 하드코딩된 색상이 있는지 확인 필요

**작업 내용:**
- [ ] 컴포넌트에서 하드코딩된 색상 검색 (`#3478F6`, `#34C759`, `#FF9500` 등)
- [ ] CSS 변수 또는 Tailwind 색상 클래스로 통일
- [ ] Alert 색상 (`#FF9500`) 사용 현황 확인 (면책 조항 등)

**예상 소요 시간**: 1시간

**참고 파일:**
- `app/globals.css` (54-59줄: PRD 색상 정의)
- 모든 컴포넌트 파일

---

### 🔵 Priority 4: 분석 기반 마련 (장기)

#### 4-1. 사용자 활동 로깅
**왜 필요한가?**
- PRD에 "사용자 활동 로깅" 요구사항 명시
- 사용자 행동 분석을 통해 개선점 도출 가능
- TODO.md에 미완료 작업으로 표시됨

**작업 내용:**
- [ ] `logUserActivity()` 함수 생성 (`lib/utils/logging.ts`)
- [ ] 병원 검색 및 조회 로그 기록
- [ ] 위치 정보 및 필터 사용 로그
- [ ] `user_activity_logs` 테이블에 저장
- [ ] 주요 이벤트에 로깅 추가 (병원 클릭, 필터 변경, 지도 이동 등)

**예상 소요 시간**: 2-3시간

**참고 파일:**
- `supabase/migrations/setup_schema.sql` (user_activity_logs 테이블)
- `app/hospitals/page-client.tsx`
- `components/HospitalMap.tsx`

---

## 📊 작업 우선순위 매트릭스

| 우선순위 | 작업 | 영향도 | 난이도 | 예상 시간 | 의존성 |
|---------|------|--------|--------|-----------|--------|
| 🔴 P1 | 재활기관 Geocoding | 높음 | 낮음 | 1-2h | 없음 |
| 🔴 P1 | 재활기관 지도 연동 | 높음 | 중간 | 3-4h | Geocoding 완료 |
| 🟡 P2 | 진료과목별 필터링 | 중간 | 중간 | 2-3h | 없음 |
| 🟡 P2 | 기관 유형별 필터링 | 중간 | 낮음 | 1-2h | 재활기관 지도 연동 |
| 🟢 P3 | 타이포그래피 검증 | 낮음 | 낮음 | 1-2h | 없음 |
| 🟢 P3 | 색상 팔레트 검증 | 낮음 | 낮음 | 1h | 없음 |
| 🔵 P4 | 사용자 활동 로깅 | 중간 | 중간 | 2-3h | 없음 |

---

## 🎯 추천 작업 순서

### Phase A: 데이터 완성 (1-2일)
1. **재활기관 Geocoding 처리** (P1-1)
2. **재활기관 지도 연동** (P1-2)

### Phase B: 필터링 기능 (1일)
3. **기관 유형별 필터링** (P2-2) - 재활기관 지도 연동 직후
4. **진료과목별 필터링** (P2-1)

### Phase C: 디자인 시스템 정리 (반나절)
5. **타이포그래피 검증** (P3-1)
6. **색상 팔레트 검증** (P3-2)

### Phase D: 분석 기반 마련 (1일)
7. **사용자 활동 로깅** (P4-1)

---

## 💡 작업 시작 전 확인사항

### 재활기관 Geocoding 시작 전
- [ ] Geocoding API가 정상 작동하는지 테스트 (10개 샘플)
- [ ] API 호출 제한 확인 (Naver: 일일 제한, VWorld: 일일 제한)
- [ ] Geocoding 실패 시 재시도 로직 확인

### 재활기관 지도 연동 시작 전
- [ ] 재활기관 Geocoding 완료 확인 (좌표가 0이 아닌 데이터 확인)
- [ ] 재활기관 데이터 구조 확인 (`rehabilitation_centers` 테이블)
- [ ] 병원/약국 마커 색상과 구분되는 재활기관 마커 색상 결정

### 필터링 기능 시작 전
- [ ] 현재 데이터에 어떤 진료과목이 있는지 확인 (SQL 쿼리)
- [ ] 필터 UI 디자인 결정 (체크박스 vs 드롭다운 vs 토글)
- [ ] 필터 상태 관리 방식 결정 (상태 관리 vs URL 쿼리)

---

## 📝 참고 문서

- **PRD.md**: 전체 프로젝트 요구사항 및 디자인 시스템
- **TODO.md**: 상세 작업 목록 및 진행 상황
- **REHABILITATION_CENTER_API.md**: 재활기관 API 상세 정보
- **GEOCODING_PROCESS.md**: Geocoding 프로세스 가이드

---

## 🔄 업데이트 이력

- **2025-01-14**: 초안 작성 (PRD.md + TODO.md 기반)

