# 산재 재활기관 API 분석

## 📋 개요

공공데이터포털(data.go.kr)에서 제공하는 **근로복지공단 산재 재활기관 관리정보 오픈 API**에 대한 분석 문서입니다.

**참고 URL**: https://www.data.go.kr/iim/api/selectAPIAcountView.do

---

## 🔍 API 정보

### 제공 기관
- **기관명**: 근로복지공단
- **API 명**: 산재 재활기관 관리정보 오픈 API
- **데이터 형식**: XML (JSON 변환 가능 여부 확인 필요)

### 제공 데이터
웹 검색 결과에 따르면 다음 정보를 제공합니다:
- 사업장명
- 주소
- 근로자 수
- 보험료 고지 정보
- 기타 재활기관 관련 정보

---

## 📊 현재 프로젝트와의 연관성

### 현재 사용 중인 API
프로젝트에서는 이미 **산재 지정 의료기관 현황정보 API**를 사용하고 있습니다:
- **파일**: `lib/api/data-kr.ts`
- **엔드포인트**: `uddi:d9ecddd6-d2c4-4e54-8a1c-da36aeeaecc5_201906131805`
- **데이터**: 산재 지정 의료기관 (병원, 약국)

### 추가 필요성
산재 재활기관은 **의료기관과는 별도**로 관리되는 시설이므로:
- ✅ **별도 데이터 소스 필요**: 재활기관은 병원/약국과 다른 카테고리
- ✅ **사용자 서비스 확장**: 재활기관 찾기 기능 추가 가능
- ✅ **데이터 완전성**: 산재 관련 모든 시설 정보 제공

---

## 🎯 구현 계획

### 1. API 확인 사항
- [ ] API 상세 문서 확인 (data.go.kr에서)
- [ ] API 인증키 발급 방법 확인
- [ ] API 엔드포인트 URL 확인
- [ ] 응답 데이터 구조 확인
- [ ] 데이터 형식 확인 (XML/JSON)
- [ ] 페이지네이션 지원 여부 확인
- [ ] 총 데이터 수 확인

### 2. 데이터 구조 예상
```typescript
interface RehabilitationCenter {
  사업장명?: string;
  주소?: string;
  전화번호?: string;
  근로자수?: number;
  보험료?: number;
  // 기타 필드 확인 필요
}
```

### 3. 구현 단계

#### Phase 1: API 클라이언트 구현
- [ ] `lib/api/rehabilitation-center.ts` 생성
- [ ] API 클라이언트 클래스 구현
- [ ] 데이터 타입 정의
- [ ] API 호출 함수 구현

#### Phase 2: 데이터 변환 및 저장
- [ ] 데이터 변환 함수 구현
- [ ] Supabase 스키마 확인/생성
- [ ] 데이터 저장 로직 구현
- [ ] Geocoding 연동 (주소 → 좌표)

#### Phase 3: API 엔드포인트 생성
- [ ] `app/api/rehabilitation-centers/sync/route.ts` 생성
- [ ] 동기화 API 구현
- [ ] 조회 API 구현

#### Phase 4: UI 통합
- [ ] 재활기관 목록 페이지 생성
- [ ] 지도에 재활기관 마커 표시
- [ ] 필터링 기능 (병원/약국/재활기관)

---

## 📝 다음 단계

### 즉시 확인 필요
1. **API 상세 정보 확인**
   - 공공데이터포털에서 API 상세 페이지 확인
   - API 인증키 발급 방법 확인
   - API 엔드포인트 URL 확인

2. **데이터 구조 확인**
   - 실제 API 응답 샘플 확인
   - 제공되는 필드 목록 확인
   - 데이터 형식 확인 (XML/JSON)

3. **기존 API와의 통합 방안**
   - 기존 `data-kr.ts` 확장 vs 새 파일 생성
   - 데이터베이스 스키마 통합 방안
   - UI 통합 방안

---

## 🔗 참고 자료

- [공공데이터포털](https://www.data.go.kr)
- [근로복지공단 산재 재활기관 관리정보 오픈 API](https://www.data.go.kr/data/15059256/openapi.do)
- [현재 프로젝트 API 문서](./api-data-kr.md)

---

---

## 📋 확인된 정보

### API 상세 페이지
- **URL**: https://www.data.go.kr/data/15059256/openapi.do
- **제공 기관**: 근로복지공단
- **API 명**: 근로복지공단_고용/산재보험 현황정보
- **관리부서**: 근로복지연구원 노동복지빅데이터센터
- **관리부서 전화**: 02-2670-0455

### API 기본 정보
- **API 유형**: REST
- **데이터 포맷**: XML
- **비용**: 무료
- **트래픽**: 개발계정 10,000 / 운영계정 (활용사례 등록 시 증가 가능)
- **심의유형**: 자동승인 (개발/운영 단계 모두)
- **등록일**: 2017-02-07
- **수정일**: 2023-11-10

### API 엔드포인트
- **요청 주소**: `http://apis.data.go.kr/B490001/gySjbPstateInfoService/getGySjBoheomBsshItem`
- **서비스 URL**: `http://apis.data.go.kr/B490001/gySjbPstateInfoService`

### 제공 데이터 필드
**요청 파라미터**:
- `pageNo` (페이지 번호, 옵션)
- `numOfRows` (목록 건수, 옵션, 최대 100)
- `v_saeopjaDrno` (사업자등록번호, 옵션)
- `opaBoheomFg` (산재/고용 구분, 옵션, 1: 산재, 2: 고용)
- `serviceKey` (서비스키, 필수)

**응답 필드**:
- `addr` (주소, 50자)
- `saeopjangNm` (사업장명, 50자)
- `sangsiInwonCnt` (상시인원, 10자)
- `opaBoheomFg` (산재/고용구분, 1:산재, 2:고용)
- `post` (우편번호, 6자)
- `seongripDt` (성립일자, 8자, 형식: YYYYMMDD)
- `saeopjaDrno` (사업자등록번호, 10자)
- `gyEopjongNm` (고용업종명, 60자)
- `sjEopjongNm` (산재업종명, 60자)
- `saeopFg` (보험가입구분, 1: 계속, 3: 일괄계속, 4: 일괄유기, 7: 사업개시계속)

### ⚠️ 중요 확인 사항
이 API는 **"고용/산재보험 현황정보"**로, **사업장 정보**를 제공합니다.
- 산재 재활기관 전용 API인지 확인 필요
- `opaBoheomFg=1` (산재)로 필터링 시 재활기관 정보가 포함되는지 확인 필요
- 또는 별도의 재활기관 전용 API가 있는지 확인 필요

### API 활용 절차
1. **공공데이터포털 회원가입 및 로그인**
   - https://www.data.go.kr 접속
   - 회원가입 진행

2. **API 활용 신청**
   - 로그인 후 API 상세 페이지에서 '활용신청' 클릭
   - 신청 승인 대기

3. **인증키 발급**
   - 승인 후 인증키 발급
   - 인증키를 환경변수에 설정

4. **API 호출**
   - 발급받은 인증키로 API 호출
   - 필요한 파라미터 설정하여 데이터 수집

---

## 🔍 다음 단계

### 즉시 확인 필요
1. **API 상세 페이지 접속**
   - https://www.data.go.kr/data/15059256/openapi.do
   - 로그인 후 상세 정보 확인

2. **API 엔드포인트 확인**
   - Base URL 확인
   - 엔드포인트 경로 확인
   - 요청 파라미터 확인

3. **데이터 구조 확인**
   - 응답 형식 확인 (JSON/XML)
   - 제공 필드 목록 확인
   - 샘플 데이터 확인

4. **기존 API와의 비교**
   - 현재 사용 중인 의료기관 API와 구조 비교
   - 통합 방안 검토

---

---

## 🎯 프로젝트 적용 방안

### 현재 상황
- ✅ API 기본 정보 확인 완료
- ⚠️ 재활기관 전용 데이터인지 확인 필요
- ⚠️ API 인증키 발급 필요

### 다음 단계
1. **API 인증키 발급**
   - 공공데이터포털 로그인
   - API 활용 신청
   - 인증키 발급

2. **테스트 API 호출**
   - `opaBoheomFg=1` (산재)로 필터링
   - 재활기관 관련 데이터 포함 여부 확인
   - 데이터 구조 및 샘플 확인

3. **기존 API와 통합**
   - 기존 `data-kr.ts` 확장 또는 새 파일 생성
   - 데이터베이스 스키마 통합 방안 검토
   - UI 통합 (병원/약국/재활기관 필터)

---

---

## ✅ API 테스트 결과

### 테스트 일시
- **날짜**: 2025-01-14
- **인증키**: `aba6428813f7272c3d7a7918ec194233d0862839e5d1df1df223f03e1d01592a`
- **API URL**: https://www.data.go.kr/data/15058716/openapi.do

### 테스트 결과
- **상태**: ✅ **정상 작동**
- **HTTP 상태 코드**: 200 OK
- **총 데이터 수**: **2,415개**
- **API 엔드포인트**: `https://apis.data.go.kr/B490001/sjbJhgigwanGwanriInfoService/getSjbWkGigwanInfoList`

### 제공 데이터 구조

#### 응답 필드
- `gigwanNm`: 기관명
- `gigwanFg`: 기관구분 코드
- `gigwanFgNm`: 기관구분명 (직업훈련기관, 재활스포츠 위탁기관, 심리재활프로그램 위탁기관 등)
- `addr`: 주소
- `telNo`: 전화번호
- `faxNo`: 팩스번호
- `gwanriJisaCd`: 관리지사 코드
- `jisaNm`: 관리지사명

#### 기관구분 (gigwanFgNm)
API 설명에 따르면 다음 3가지 유형의 기관 정보를 제공합니다:
1. **직업훈련기관** (코드: 11)
2. **재활스포츠 위탁기관**
3. **심리재활프로그램 위탁기관**

### 샘플 데이터
```
기관명: 섬김
기관구분: 직업훈련기관 (코드: 11)
주소: 충남 천안시 서북구 천안대로 1337 (신당동, 수산물도매센타)
전화번호: 0415853435
팩스번호: 0415853436
관리지사: 대전지역본부 (코드: 7000)
```

### 환경변수 설정
`.env` 파일에 다음을 추가 (또는 기존 `TOUR_API_KEY` 사용):
```bash
REHABILITATION_API_KEY=aba6428813f7272c3d7a7918ec194233d0862839e5d1df1df223f03e1d01592a
```

### API 호출 예시
```javascript
const url = `https://apis.data.go.kr/B490001/sjbJhgigwanGwanriInfoService/getSjbWkGigwanInfoList?serviceKey=${API_KEY}&pageNo=1&numOfRows=100`;
```

### 데이터 Import 결과
- **Import 일시**: 2025-01-14
- **API 전체 데이터**: 2,415개
- **Supabase 저장**: 2,368개 (97.1%)
- **누락된 데이터**: 47개 (기관명/주소가 없는 항목으로 API 필터링됨)
- **Geocoding**: 별도 API로 처리 필요 (`/api/rehabilitation-centers/geocode`)

### 다음 단계
1. ✅ API 테스트 완료
2. ✅ 전체 데이터 Import 완료 (2,368개)
3. [ ] Geocoding 처리 (주소 → 위도/경도 변환)
4. [ ] API 클라이언트 함수 구현 (`lib/api/rehabilitation-center.ts`)
5. [ ] 지도 연동 및 마커 표시
6. [ ] UI 통합 (병원/약국/재활기관 필터)

---

**작성일**: 2025-01-14  
**상태**: ✅ API 정상 작동 및 데이터 Import 완료

