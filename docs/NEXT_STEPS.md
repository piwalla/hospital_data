# 다음 단계 작업 가이드

## 📋 현재 상태 요약

### ✅ 완료된 작업
1. **API 클라이언트 및 데이터 동기화**
   - 공공데이터포털 API 연동 완료
   - 데이터 동기화 테스트 성공 (100개 저장)
   - Geocoding API 연동 완료

2. **지도 컴포넌트**
   - 네이버 Dynamic Map 연동 완료
   - 병원 마커 표시 기능 구현
   - 반응형 레이아웃 구현

3. **기본 UI/UX**
   - 반응형 네비게이션 구현
   - 디자인 시스템 적용

---

## 🎯 다음 우선순위 작업

### 1. 병원 상세 정보 표시 (Bottom Sheet) ⭐ 최우선

**목표**: 사용자가 병원 마커나 목록 항목을 클릭했을 때 상세 정보를 보여주는 Bottom Sheet 구현

**구현 단계**:

#### 1-1. Bottom Sheet 컴포넌트 생성
```bash
# shadcn/ui sheet 컴포넌트 설치
pnpx shadcn@latest add sheet
```

또는 직접 구현:
- `components/HospitalDetailSheet.tsx` 생성
- 드래그 제스처 지원 (모바일)
- 애니메이션 효과

#### 1-2. 병원 상세 정보 UI
- 병원명 및 진료과목 표시
- 주소, 전화번호 표시
- 전화 걸기 버튼 (Primary CTA)
- 길찾기 버튼 (Secondary CTA)

#### 1-3. 연동 작업
- `HospitalMap` 컴포넌트에서 마커 클릭 시 Bottom Sheet 열기
- `app/hospitals/page.tsx`의 목록 항목 클릭 시 Bottom Sheet 열기

**예상 소요 시간**: 2-3시간

---

### 2. 반경 5km 내 검색 로직 ⭐ 높은 우선순위

**목표**: 사용자 위치 기준 5km 반경 내 병원만 필터링하여 표시

**구현 단계**:

#### 2-1. 거리 계산 함수
- `lib/utils/distance.ts` 생성
- Haversine 공식으로 두 좌표 간 거리 계산

#### 2-2. 필터링 로직
- `HospitalMap`에서 사용자 위치 가져오기
- `getHospitalsNearby()` 함수 활용 (이미 구현됨)
- 반경 5km 내 병원만 필터링

#### 2-3. UI 업데이트
- 필터링된 병원 수 표시
- 목록에 거리 정보 추가 (예: "1.2km")
- 가까운 순으로 정렬

**예상 소요 시간**: 1-2시간

---

### 3. 진료과목별 필터링

**목표**: 사용자가 원하는 진료과목으로 병원을 필터링

**구현 단계**:

#### 3-1. 필터 UI 컴포넌트
- `components/HospitalFilter.tsx` 생성
- 주요 진료과: 정형외과, 신경외과, 재활의학과 등
- Filter Pills 형태 (design.md 참고)

#### 3-2. 필터링 로직
- `getHospitalsByDepartment()` 함수 활용
- 다중 선택 지원
- 필터 적용 시 지도 마커 업데이트

**예상 소요 시간**: 1-2시간

---

### 4. 사용자 활동 로깅

**목표**: 사용자 행동 패턴 분석을 위한 로그 기록

**구현 단계**:

#### 4-1. 로깅 함수
- `lib/api/activity-logs.ts` 생성
- `logUserActivity()` 함수 구현
- `user_activity_logs` 테이블에 저장

#### 4-2. 이벤트 추적
- 병원 검색 이벤트
- 병원 조회 이벤트
- 필터 사용 이벤트
- 위치 정보 기록

**예상 소요 시간**: 1시간

---

## 🚀 추천 진행 순서

### 옵션 A: 사용자 경험 우선 (추천)
1. **병원 상세 정보 표시 (Bottom Sheet)** - 가장 시급
2. **반경 5km 내 검색 로직** - 핵심 기능
3. **진료과목별 필터링** - 기능 보완
4. **사용자 활동 로깅** - 분석 기반

### 옵션 B: 핵심 기능 우선
1. **반경 5km 내 검색 로직** - 핵심 기능
2. **병원 상세 정보 표시 (Bottom Sheet)** - 사용자 경험
3. **진료과목별 필터링** - 기능 보완
4. **사용자 활동 로깅** - 분석 기반

---

## 📝 구현 시 참고 사항

### Bottom Sheet 구현
- **디자인 참고**: `docs/design.md` 화면 1-A 섹션
- **반응형**: 모바일은 드래그, 데스크톱은 클릭
- **애니메이션**: 부드러운 슬라이드 업/다운 효과

### 거리 계산
- **공식**: Haversine 공식 사용
- **단위**: 킬로미터 (km)
- **표시**: 소수점 첫째 자리까지 (예: "1.2km")

### 필터링
- **실시간**: 필터 변경 시 즉시 반영
- **지도 동기화**: 필터 적용 시 마커 자동 업데이트
- **목록 동기화**: 필터 적용 시 목록 자동 갱신

---

## 🔗 관련 파일

- `components/HospitalMap.tsx` - 지도 컴포넌트
- `app/hospitals/page.tsx` - 병원 찾기 페이지
- `lib/api/hospitals.ts` - 병원 데이터 조회 함수
- `docs/design.md` - 디자인 가이드
- `docs/PRD.md` - 제품 요구사항


