# 약국 데이터 지오코딩 진행 상황

## 📊 현재 상태

**시작 시간**: 2025-11-20  
**총 약국 데이터**: 23,022개  
**목표**: 모든 약국 데이터의 주소를 위도/경도로 변환

---

## 🔄 진행 상황

### 최신 통계 (2025-11-20 업데이트)
- **지오코딩 완료**: 14,035개 (60.96%)
- **남은 데이터**: 8,987개 (39.04%)
- **마지막 업데이트**: 2025-11-20 11:09:43

### 진행 이력

#### 1단계: 초기 상태 확인 (2025-11-20)
- **시작 시점**: 3,042개 완료 (13.2%)
- **미완료**: 19,980개 (86.8%)
- **상태**: 컴퓨터 재부팅으로 중단된 지점 확인

#### 2단계: Naver API 배치 처리
- **실행 횟수**: 여러 차례
- **배치 크기**: 100개씩
- **API 딜레이**: 150ms
- **결과**: 
  - 초기 성공률: 약 35-50%
  - 후반부 성공률: 0-16%로 감소
  - 남은 데이터는 대부분 Naver API에서 실패한 주소들

#### 3단계: VWorld API 재시도
- **실행 횟수**: 여러 차례
- **배치 크기**: 200-4000개씩
- **API 딜레이**: 120-200ms
- **결과**:
  - 성공률: 약 50-80%
  - VWorld API가 Naver에서 실패한 주소 중 상당수를 성공적으로 처리
  - 총 15,000개 처리 중 4,651개 성공 (31%)

#### 4단계: Naver API 재시도
- **실행 횟수**: 1회 (50배치)
- **배치 크기**: 100개씩
- **결과**: 
  - 성공: 0개
  - 실패: 5,000개
  - **결론**: 남은 데이터는 모두 Naver API에서 실패한 주소들

---

## 📈 누적 진행 상황

| 단계 | 완료 개수 | 진행률 | 비고 |
|------|----------|--------|------|
| 시작 시점 | 3,042개 | 13.2% | 재부팅 전 상태 |
| Naver 1차 | ~3,389개 | 14.7% | 초기 배치 처리 |
| VWorld 1차 | ~3,529개 | 15.3% | VWorld 재시도 시작 |
| Naver 2차 | ~5,458개 | 23.7% | 대량 배치 처리 |
| VWorld 2차 | ~6,670개 | 28.9% | VWorld 대량 처리 |
| VWorld 3차 | ~8,706개 | 37.8% | VWorld 반복 처리 |
| VWorld 4차 | ~13,931개 | 60.4% | VWorld 대량 반복 처리 |
| **현재** | **14,035개** | **60.96%** | **최종 상태** |

---

## 🔍 실패 패턴 분석

### 반복 실패 주소 예시
다음 주소들은 Naver API와 VWorld API 모두에서 실패했습니다:

1. **한마음약국** - 서울 강남구 테헤란로 456
2. **우리약국** - 부산 해운대구 해운대해변로 789
3. **행복약국** - 대구 수성구 범어천로 321

### 실패 원인 추정
- 주소 형식이 불완전하거나 잘못된 형식
- 실제 존재하지 않는 주소일 가능성
- 도로명 주소가 아닌 지번 주소 또는 불완전한 정보

---

## 📝 진행 상황 확인 방법

### 1. 데이터베이스 직접 확인
```sql
SELECT 
  COUNT(*) as total,
  COUNT(CASE WHEN latitude != 0 AND longitude != 0 THEN 1 END) as geocoded,
  COUNT(CASE WHEN latitude = 0 OR longitude = 0 THEN 1 END) as remaining,
  ROUND(COUNT(CASE WHEN latitude != 0 AND longitude != 0 THEN 1 END)::numeric / COUNT(*)::numeric * 100, 2) as success_rate
FROM hospitals_pharmacies 
WHERE type = 'pharmacy';
```

### 2. API로 확인
```bash
GET http://localhost:3000/api/pharmacies/status
```

### 3. 스크립트로 확인
```bash
node scripts/check-geocoding-progress.js
```

---

## 🚀 사용한 스크립트

### Naver API 지오코딩
```bash
node scripts/geocode-pharmacies.js --batch-size=100 --max-batches=50
```

### VWorld API 지오코딩
```bash
node scripts/geocode-pharmacies-vworld.js --batch-size=1000 --delay=120 --iterations=15
```

또는 직접 API 호출:
```bash
curl -X POST 'http://localhost:3000/api/hospitals/geocode-vworld?limit=1000&delayMs=120'
```

---

## ⏭️ 다음 단계 제안

### 옵션 1: VWorld API 추가 처리
- 남은 8,987개를 VWorld API로 계속 처리
- 일부 주소는 재시도로 성공할 수 있음

### 옵션 2: 주소 정규화
- 실패한 주소들을 분석하여 주소 형식 정규화
- 불완전한 주소 정보 보완 후 재시도

### 옵션 3: 수동 확인
- 반복 실패 주소들을 수동으로 확인
- 올바른 주소로 수정 후 재시도

---

## 💡 주요 발견 사항

1. **VWorld API가 Naver API보다 성공률이 높음**
   - Naver에서 실패한 주소 중 상당수를 VWorld가 성공적으로 처리
   - VWorld 성공률: 약 50-80%
   - Naver 후반부 성공률: 0-16%

2. **남은 데이터는 모두 실패 패턴**
   - 남은 8,987개는 Naver와 VWorld 모두에서 실패
   - 주소 형식 문제 또는 잘못된 주소일 가능성

3. **배치 처리 효율성**
   - VWorld API는 대량 배치 처리에 적합 (1000-4000개씩)
   - Naver API는 초기 처리에 효과적이지만 후반부 성공률 급감

---

## 📊 성공률 비교

| API | 초기 성공률 | 후반부 성공률 | 전체 평균 |
|-----|-----------|------------|----------|
| Naver | 35-50% | 0-16% | 약 28% |
| VWorld | 50-80% | 30-60% | 약 50-70% |

---

## 🎯 목표 달성 현황

- **목표**: 23,022개 전체 지오코딩
- **현재**: 14,035개 완료 (60.96%)
- **남은 작업**: 8,987개 (39.04%)

---

**마지막 업데이트**: 2025-11-20 11:09:43
