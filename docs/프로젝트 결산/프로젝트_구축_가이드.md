# 🏗️ 프로젝트 구축 및 환경세팅 상세 가이드 (Project Construction Guide)

이 문서는 아이디어 단계부터 실제 배포까지, **이 프로젝트가 처음 어떻게 만들어졌는지** 모든 과정을 단계별로 기록한 상세 가이드입니다.
만약 프로젝트를 처음부터 다시 만들거나, 새로운 환경에서 똑같이 구축해야 한다면 이 가이드를 따라가세요.

---

---

## 0. 🛠️ 사전 준비 (Pre-requisites)

프로젝트를 시작하기 전에 아래 도구들을 내 컴퓨터에 설치해야 합니다.

### 0-1. Node.js (필수)

Javascript 실행 환경입니다. **안정적인 LTS (Long Term Support) 버전**을 설치하는 것이 중요합니다.

1.  **다운로드**: [Node.js 공식 홈페이지(ko)](https://nodejs.org/ko) 접속
2.  **버전 선택**: `LTS` 탭 선택 (예: v22.20.0 LTS) -> `Windows Installer (.msi)` 다운로드
3.  **설치**: 다운로드 받은 파일을 실행하고, 특별한 설정 변경 없이 `Next`를 눌러 설치 완료 (기본 설정 권장)
4.  **확인**: 터미널(PowerShell)을 열고 아래 명령어로 설치 확인
    ```bash
    node -v
    # v22.xx.x 버전이 나오면 성공
    npm -v
    # v10.xx.x 버전이 나오면 성공
    ```

### 0-2. Cursor (AI 에디터)

VS Code를 기반으로 만들어진 강력한 AI 코드 에디터입니다. 이 프로젝트는 Cursor를 활용해 구축되었습니다.

1.  **다운로드**: [Cursor 공식 홈페이지](https://cursor.com) 접속
2.  **설치**: `Download` 버튼 클릭 후 설치 프로그램(`CursorSetup-x64.exe`) 실행 (기본 경로 권장)
3.  **가입 및 인증**: 설치 후 실행 -> GitHub 계정으로 가입 -> 이메일로 온 6자리 인증번호 입력
4.  **추천 설정**:
    - **관리자 권한**: 바탕화면 아이콘 우클릭 -> 속성 -> 고급 -> `관리자 권한으로 실행` 체크 (안정성 확보)
    - **한글 패치**: 마켓플레이스에서 `Korean Language Pack` 설치
    - **AI 설정 (`Ctrl+I`)**:
      - `Rules for AI`에 프로젝트 관련 규칙(프롬프트)을 추가하면 더 정확한 코드를 작성해줍니다.
      - `Include Full-Folder Context` 기능을 켜서 프로젝트 전체를 이해하도록 설정하세요.

### 0-3. Git (버전 관리)

코드의 변경 이력을 저장하고 관리하는 도구입니다.

1.  **다운로드**: [Git 공식 홈페이지](https://git-scm.com/) 접속 -> `Downloads` -> `Windows` -> `64-bit Git for Windows Setup` 다운로드
2.  **설치**: 다운로드 받은 실행 파일(`Git-2.xx.x-64-bit.exe`) 실행
3.  **설치 옵션**: 대부분 `Next`를 눌러 기본값으로 진행하되, 아래 항목들은 확인해주세요.
    - **Default Editor**: `Use Vim` (기본값 유지)
    - **Default Branch Name**: `Let Git decide` 선택
    - **Path Environment**: `Git from the command line and also from 3rd-party software` (두 번째 옵션) 선택 **(중요)**
    - **HTTPS Transport**: `Use the native Windows Secure Channel library` 선택
    - **Line Ending**: `Checkout Windows-style, commit Unix-style line endings` 선택
4.  **확인**: 터미널(PowerShell)을 열고 아래 명령어로 설치 확인
    ```bash
    git --version
    # git version 2.xx.x.windows.x 형식이 나오면 성공
    ```

### 0-4. Docker (컨테이너 도구)

데이터베이스 및 AI 모델 등을 컨테이너 환경에서 실행하기 위한 도구입니다.

1.  **다운로드**: [Docker 공식 홈페이지](https://www.docker.com/) 접속 -> `Download Docker Desktop` 클릭 (Windows용)
2.  **설치 전 확인사항 (Windows)**:
    - Windows 검색창에 `Windows 기능 켜기/끄기` 검색
    - **Hyper-V**, **Linux용 Windows 하위 시스템**, **Windows 하이퍼바이저 플랫폼** 3가지 항목 체크 -> 확인 -> **재부팅**
3.  **설치**: 다운로드 받은 `Docker Desktop Installer.exe` 실행
    - **Configuration**: `Use WSL 2 instead of Hyper-V` (권장), `Add shortcut to desktop` 등 모든 항목 체크 -> `OK`
    - 설치 완료 후 `Close and restart` 클릭하여 재부팅
4.  **초기 설정**:
    - 실행 후 Service Agreement에 `Accept` 클릭
    - (WSL 업데이트 필요 시) PowerShell(관리자)에서 `wsl --update` 실행
    - "Welcome to Docker" 화면에서 `Skip` 가능
5.  **확인**: Docker Desktop이 실행되고 좌측 하단 상태가 **Engine running** (초록색)인지 확인

### 0-5. WSL (리눅스 실행 환경)

Windows에서 리눅스 명령어를 사용하기 위한 필수 환경입니다. (Docker 등을 위해 필요)

1.  **설치**: PowerShell을 **관리자 권한**으로 실행하고 아래 명령어를 입력합니다.
    ```bash
    wsl --install
    ```
2.  **재부팅**: 설치가 완료되면 컴퓨터를 **반드시 재부팅**해야 적용됩니다.
3.  **계정 설정**:
    - 재부팅 후 자동으로 열리는 터미널(Ubuntu)에서 사용할 `username`(아이디)과 `password`(비밀번호)를 설정합니다.
    - _주의: 비밀번호 입력 시 화면에 글자가 보이지 않는 것은 정상 보안 기능입니다._
4.  **업데이트** (선택): 최신 커널 적용을 위해 실행합니다.
    ```bash
    wsl --update
    ```
5.  **확인**: PowerShell에서 설치 상태를 확인합니다.
    ```bash
    wsl --list --verbose
    # Ubuntu   Running   2   형식으로 뜨면 성공
    ```

### 0-6. n8n (워크플로우 자동화)

다양한 서비스(Notion, Slack, LLM 등)를 연결하여 자동화 워크플로우를 만드는 도구입니다. Docker를 통해 실행합니다.

1.  **Docker로 실행**: PowerShell에서 아래 명령어를 한번에 복사하여 실행합니다. (Windows Docker 기준)
    ```bash
    docker run -it --rm `
     --name n8n `
     -p 5678:5678 `
     -e GENERIC_TIMEZONE="Asia/Seoul" `
     -e TZ="Asia/Seoul" `
     -e N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true `
     -e N8N_RUNNERS_ENABLED=true `
     -v n8n_data:/home/node/.n8n `
     docker.n8n.io/n8nio/n8n
    ```
2.  **설정 값 설명**:
    - `-p 5678:5678`: 로컬 웹 브라우저의 5678 포트로 접속합니다.
    - `-v n8n_data...`: 워크플로우 데이터를 보존하기 위해 `n8n_data`라는 볼륨을 사용합니다.
    - `TZ="Asia/Seoul"`: 한국 시간대로 설정합니다.
3.  **접속**: 브라우저 주소창에 `http://localhost:5678` 입력
4.  **초기 설정**:
    - `Set up owner account` 화면이 나오면 이메일/비밀번호 입력 후 계정 생성
    - 처음 생성한 계정이 관리자(Owner)가 됩니다.

### 0-7. UV (Python 패키지 매니저)

Python 프로젝트 관리 및 패키지 설치 속도가 매우 빠른 최신 도구입니다.

1.  **설치**: PowerShell을 실행하고 아래 명령어를 입력합니다.
    ```powershell
    powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
    ```
    또는 짧은 버전:
    ```powershell
    irm https://astral.sh/uv/install.ps1 | iex
    ```
2.  **확인**: "everything's installed!" 메시지가 나오면 버전을 확인합니다.
    ```bash
    uv --version
    # 예: uv 0.4.x 등 버전 번호가 나오면 성공
    ```
3.  **활용 팁**:
    - 가상환경 생성: `uv venv`
    - 패키지 설치: `uv pip install 패키지명`
    - 스크립트 실행: `uv run 스크립트명.py`

### 0-8. Bun (자바스크립트 런타임)

Node.js보다 빠르고 강력한 최신 자바스크립트 런타임입니다.

1.  **설치**: PowerShell을 **관리자 권한**으로 실행하고 아래 명령어를 입력합니다.
    ```powershell
    powershell -c "irm bun.sh/install.ps1 | iex"
    ```
2.  **확인**: 설치 완료 후, **새 터미널(PowerShell)**을 열고 버전을 확인합니다.
    ```bash
    bun --version
    # 예: 1.x.x 버전 번호가 나오면 성공
    ```
3.  **참고**: 공식 문서(bun.sh)에서 더 많은 사용법(run, install, upgrade 등)을 확인할 수 있습니다.

---

## 1. 💡 아이디어 찾기

- **방법**: n8n 같은 자동화 툴을 이용하여 커뮤니티(산재 관련 카페, 게시판 등)의 각종 불편 사항을 수집합니다.
- **목표**: 수집된 데이터를 정제하여 사용자가 겪는 진짜 문제를 찾아내고, 해결 방법을 아이디어로 도출합니다.

## 2. 📄 PRD (제품 요구사항 정의서) 생성

- **기법**: 메타 프롬프트를 사용하여 PRD(Product Requirement Document), MRD(Market Requirements Document), TRD(Technical Requirements Document)를 함께 생성합니다.
- **고도화**: '50인의 가상 페르소나'를 생성하여 도출된 아이디어를 평가하고 피드백을 받습니다.

## 3. 🤖 PRD 평가 및 최종 확정

- **LLM 상담**: 작성된 PRD를 LLM(AI)과 상담하며 부족한 점을 보완합니다.
- **Cursor용 PRD**: 개발 도구인 Cursor에서 사용할 수 있도록 최적화된 PRD를 만듭니다.
  - _Tip_: '15년차 풀스택 개발자'라는 페르소나를 부여하여 기술적인 완성도를 높입니다.

---

## 4. 📦 보일러플레이트 설치

기반이 되는 코드를 설치하는 단계입니다.

1.  **다운로드**: [Next.js Supabase Boilerplate GitHub](https://github.com/demoedu/nextjs-supabase-boilerplate)에서 Zip 파일을 다운로드하거나 Clone 합니다.
2.  **pnpm 설치**:
    ```bash
    npm install -g pnpm
    pnpm --version
    ```
3.  **패키지 설치**:
    ```bash
    pnpm install
    ```
4.  **실행 테스트**:
    ```bash
    pnpm run dev
    ```
    화면이 정상적으로 나오는지 확인합니다.
5.  **폴더 정리**:
    - `docs` 폴더 생성
    - `docs/PRD.md` 파일 생성
    - `reference` 폴더 생성
    - 루트 경로에 `.env.local` 파일 생성 (`.env.example` 복사)

---

## 5. 🗄️ Supabase 세팅 (MCP 활용)

데이터베이스 설정을 진행합니다. Cursor의 MCP(Model Context Protocol) 기능을 사용하면 편리합니다.

1.  **환경변수 가져오기**: Supabase Project Settings에서 아래 값들을 찾아 `.env` 파일에 저장합니다. (MCP를 통해 자동화 가능)
    - `NEXT_PUBLIC_SUPABASE_URL`
    - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
    - `SUPABASE_SERVICE_ROLE_KEY` (주의: 보안 중요)
    - `SUPABASE_PROJECT_ID`

## 6. 💾 Supabase Storage (파일 저장소) 설정

이미지나 문서를 저장할 공간(Bucket)을 만듭니다.

1.  **버킷 생성**: 이름은 `uploads`로 생성합니다.
2.  **공개 설정**: `Public bucket` 토글을 **활성화**합니다.
3.  **파일 제한**:
    - `Restrict file size`: 필요 시 크기 제한
    - `Restrict MIME types`: `image/*`로 설정하여 이미지만 받도록 제한 가능
4.  **보안 정책 (Policies) 설정**: **중요!** (RLS 미사용 기준)
    - `New Policy` -> `For full customization` 선택
    - **Policy Name**: `all_user_crud`
    - **Allowed Operation**: `SELECT`, `INSERT`, `UPDATE`, `DELETE` 모두 체크
    - **Target Roles**: `anon`, `authenticated`, `service_role` 모두 체크
    - `Review` -> `Save Policy`
5.  **환경변수 추가**: `.env` 파일에 `NEXT_PUBLIC_STORAGE_BUCKET="uploads"` 추가

## 7. 🗃️ DB 테이블 생성 (SQL)

Supabase SQL 에디터에서 테이블을 만듭니다.

1.  `docs/PRD.md`를 참고하여 필요한 SQL을 작성합니다.
2.  **Clerk 연동을 위한 Users 테이블 필수 생성**:
    ```sql
    -- Users 테이블 생성
    CREATE TABLE IF NOT EXISTS public.users (
      id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
      clerk_id TEXT NOT NULL UNIQUE,
      name TEXT NOT NULL,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL
    );
    -- 권한 설정 (RLS 비활성화 예시)
    ALTER TABLE public.users OWNER TO postgres;
    ALTER TABLE public.users DISABLE ROW LEVEL SECURITY;
    GRANT ALL ON TABLE public.users TO anon;
    GRANT ALL ON TABLE public.users TO authenticated;
    GRANT ALL ON TABLE public.users TO service_role;
    ```
3.  `Run` 버튼을 눌러 실행합니다.

---

## 8. 🔐 Clerk (로그인) 세팅

1.  [Clerk Dashboard](https://dashboard.clerk.com) 접속 -> `Create application`
2.  로그인 방식 선택 (Email, Google, GitHub 등)
3.  **패키지 설치**:
    ```bash
    pnpm add @clerk/nextjs
    ```
4.  **환경변수 설정**: `Set your Clerk API keys`의 값들을 `.env` (또는 `.env.local`)에 붙여넣기

## 9. 🤝 Clerk + Supabase 연동

Clerk에 가입하면 Supabase에도 자동으로 알리기 위한 설정입니다.

1.  Clerk Dashboard -> `Configure` -> `Integrations`
2.  **Supabase** 검색 후 토글 켜기 -> `Manage integration`
3.  `Select your instance`: Personal workspace 선택
4.  `Select application`: 내 프로젝트 선택
5.  **JWT Template 확인**: `Populate your clerk domain in supabase` 부분의 도메인/URL 복사
6.  **Supabase 설정**:
    - Supabase Dashboard -> `Authentication` -> `Providers`
    - `Add Provider` -> `Clerk` 선택 또는 `Phone`(옵션) 하단의 `Third-Party Auth` 등 확인 (최신 UI 확인 필요)
    - 복사한 도메인/URL 정보 입력

---

## 10. ✅ 연동 테스트

1.  서버 실행: `pnpm run dev`
2.  **테스트 항목**:
    - 회원가입/로그인이 잘 되는지 (Clerk + Supabase 연동)
    - 이미지 업로드가 잘 되는지 (Storage)

---

## 11. 🐙 GitHub 연동

1.  [GitHub](https://github.com) 접속 -> `New repository`
2.  프로젝트 이름 입력 후 `Create`
3.  **로컬 프로젝트와 연결**:
    ```bash
    git init
    git add .
    git commit -m "Initial commit"
    git branch -M main
    git remote add origin [깃허브 주소]
    git push -u origin main
    ```
4.  GitHub 페이지에서 코드가 잘 올라갔는지 확인

## 12. ▲ Vercel 배포

1.  [Vercel](https://vercel.com) -> `Add New` -> `Project`
2.  `Import Git Repository` -> 방금 만든 GitHub 레포지토리 `Import`
3.  **설정**:
    - Framework Preset: `Next.js`
    - Root Directory: `.` (기본값)
4.  `Deploy` 클릭 (환경변수가 없어서 에러가 날 수 있음)

## 13. ⚙️ Vercel 환경변수 설정

1.  Vercel Project Settings -> `Environment Variables`
2.  로컬 `.env` 파일에 있는 모든 키/값(`KEY=VALUE`)을 복사해서 추가
    - Supabase 관련 키, Clerk 관련 키 등
3.  `Save` 후 **Redeploy** (재배포) 실행

---

## 14. 🗺️ 흐름도 (Mermaid) 만들기

1.  PRD와 SQL 구조를 바탕으로 [Mermaid Live Editor](https://mermaid.live) 등에서 사용자 흐름도 작성
2.  작성된 내용을 `docs/reference/mermaid.md`로 저장

## 15. 📚 문서 정리

AI(Cursor)가 참고할 수 있도록 문서를 정리합니다.

- `docs/PRD.md`: 기획서
- `supabase/migrations/*.sql`: 데이터베이스 구조
- `docs/reference/mermaid.md`: 흐름도
- 그 외 참고자료는 `docs/` 폴더에 보관

## 16. ✅ TODO 리스트 업데이트

1.  `PRD.md`, `mermaid.md`, `schema.sql`을 기준으로 `TODO.md` 작성을 AI에게 요청
2.  작업 단위를 **Phase**별로 나누어 체계적으로 관리

---

## 17. 🛡️ Supabase RLS (Row Level Security) 설정 (MVP 마무리)

MVP 개발 단계에서는 편의를 위해 RLS를 꺼두었지만(Step 7), **배포 전에는 반드시 보안 설정을 강화**해야 합니다.
직접 SQL을 짜는 것보다 AI를 활용하여 내 코드베이스에 딱 맞는 정책을 만드는 것이 효율적입니다.

1.  **준비 작업**:
    - Supabase Dashboard -> **Table Editor**로 이동
    - `users` 테이블 등 모든 테이블의 **RLS Enabled** 체크 박스가 켜져 있는지 확인 (꺼져 있다면 켜주세요)
    - _주의: RLS가 꺼져 있으면 Public Key(Anon Key)만으로 누구나 DB 데이터를 조작할 수 있습니다._

2.  **AI를 활용한 정책 생성 워크플로우**:
    - 프로젝트 루트에서 다음 명령어로 전체 코드를 텍스트로 변환합니다:
      ```bash
      npx -y repomix
      ```
    - 생성된 `repomix-output.txt` 파일 내용을 복사합니다.
    - AI 모델(Gemini, ChatGPT 등)에게 아래와 같이 프롬프트를 입력합니다:
      > "내 코드 베이스(`repomix-output.txt` 내용 참고)를 바탕으로 RLS 정책을 작성해줘.
      > 내 Supabase 데이터베이스 스키마는 다음과 같아..."
    - _Tip_: 특히 `Clerk`과 연동된 경우, `auth.uid()`와 `users` 테이블의 매핑 로직을 AI가 잘 파악하도록 설명하면 정확도가 높아집니다.

3.  **정책 적용**:
    - AI가 짜준 SQL 코드를 Supabase **SQL Editor**에 붙여넣고 실행합니다.
    - 적용 후 앱이 정상 작동하는지(본인 데이터만 보이는지 등) 테스트합니다.

---

_이 가이드는 프로젝트 초기 구축 시 사용된 실제 프로세스를 정리한 것입니다._
